<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Impress√£o 3D - Prisma Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #6A0DAD;
            --primary-light: #8425E3;
            --secondary: #00BFFF;
            --accent: #C7B3FF;
            --dark: #0D0D0D;
            --dark-light: #1A1A1A;
            --text: #E6E6E6;
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #F44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            margin: 20px auto;
            padding: 30px;
            background: var(--dark-light);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }
        
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .prisma-logo {
            width: 80px;
            height: 80px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .prisma-triangle {
            width: 80px;
            height: 70px;
            position: relative;
            transform: rotate(0deg);
        }
        
        .prisma-triangle::before {
            content: "";
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 40px 0px 40px 70px;
            border-color: transparent transparent transparent var(--primary);
            filter: drop-shadow(0 0 10px rgba(199, 179, 255, 0.3));
        }
        
        .prisma-triangle::after {
            content: "";
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 35px 60px 35px;
            border-color: transparent transparent transparent;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            top: 5px;
            left: 5px;
        }
        
        .prisma-inner {
            position: absolute;
            width: 60px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            clip-path: polygon(0 0, 100% 50%, 0 100%);
            top: 12px;
            left: 6px;
            z-index: 2;
        }
        
        .brand-text {
            font-size: 28px;
            font-weight: bold;
            text-transform: uppercase;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .contact {
            font-size: 18px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--accent);
            font-size: 28px;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--accent);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #444;
            border-radius: 8px;
            background: #2A2A2A;
            color: var(--text);
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(106, 13, 173, 0.3);
        }
        
        .time-inputs {
            display: flex;
            gap: 10px;
        }
        
        .time-inputs input {
            flex: 1;
        }
        
        .price-display {
            background: #2A2A2A;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: var(--accent);
        }
        
        .price-display span {
            color: var(--text);
            font-weight: 600;
        }
        
        .slider-container {
            margin-top: 10px;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #444;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }
        
        .slider-value {
            text-align: right;
            margin-top: 5px;
            font-weight: 600;
            color: var(--accent);
        }
        
        .color-palette {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border-color: var(--secondary);
            transform: scale(1.1);
        }
        
        .energy-flags {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .energy-flag {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .energy-flag:hover {
            transform: translateY(-2px);
        }
        
        .energy-flag.selected {
            border-color: white;
        }
        
        .flag-green {
            background-color: #4CAF50;
            color: white;
        }
        
        .flag-yellow {
            background-color: #FFC107;
            color: black;
        }
        
        .flag-red1 {
            background-color: #F44336;
            color: white;
        }
        
        .flag-red2 {
            background-color: #B71C1C;
            color: white;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 14px 30px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 13, 173, 0.4);
        }
        
        .btn-secondary {
            background: #444;
            color: var(--text);
        }
        
        .btn-secondary:hover {
            background: #555;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: var(--dark-light);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            color: var(--text);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s;
            position: relative;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-content::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 15px 15px 0 0;
        }
        
        .close {
            color: var(--accent);
            font-size: 24px;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 20px;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: var(--secondary);
        }
        
        .result-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--accent);
        }
        
        .result-details {
            text-align: left;
            margin: 20px 0;
            padding: 20px;
            background: #2A2A2A;
            border-radius: 8px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #444;
        }
        
        .result-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .result-total {
            font-size: 20px;
            font-weight: bold;
            color: var(--accent);
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid var(--primary);
        }
        
        .client-info {
            background: #2A2A2A;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .client-info h3 {
            margin-bottom: 15px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .client-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .legal-notice {
            background: #2A2A2A;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid var(--warning);
        }
        
        .legal-notice h3 {
            color: var(--warning);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .notice-content {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .notice-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .footer {
            margin-top: 30px;
            text-align: center;
            color: #777;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .calculator-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .energy-flags {
                flex-direction: column;
            }
            
            .client-info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="brand">
                <div class="prisma-logo">
                    <div class="prisma-triangle">
                        <div class="prisma-inner"></div>
                    </div>
                </div>
                <div class="brand-text">Prisma Studio</div>
            </div>
            <div class="contact">
                <i class="fas fa-phone-alt"></i>
                (31) 9 8339-9262
            </div>
        </div>
        
        <h1>Calculadora de Custo de Impress√£o 3D</h1>
        
        <div class="client-info">
            <h3><i class="fas fa-user"></i> Informa√ß√µes do Cliente e Pedido</h3>
            <div class="client-info-grid">
                <div class="input-group">
                    <label for="nomeCliente">Nome do Cliente</label>
                    <input type="text" id="nomeCliente" placeholder="Nome completo do cliente">
                </div>
                <div class="input-group">
                    <label for="produto">Nome do Produto</label>
                    <input type="text" id="produto" placeholder="Nome do produto a ser impresso">
                </div>
                <div class="input-group">
                    <label for="dataPedido">Data do Pedido</label>
                    <input type="date" id="dataPedido">
                </div>
                <div class="input-group">
                    <label for="observacoes">Observa√ß√µes</label>
                    <textarea id="observacoes" placeholder="Detalhes adicionais sobre o pedido" rows="2"></textarea>
                </div>
            </div>
        </div>
        
        <div class="calculator-grid">
            <div class="input-section">
                <div class="input-group">
                    <label for="tempoHoras">Tempo de Impress√£o</label>
                    <div class="time-inputs">
                        <input type="number" id="tempoHoras" placeholder="Horas" min="0" value="0">
                        <input type="number" id="tempoMinutos" placeholder="Minutos" min="0" max="59" value="0">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="filamento">Quantidade de Filamento (g)</label>
                    <input type="number" id="filamento" placeholder="Digite os gramas" min="0" step="0.1">
                </div>
                
                <div class="input-group">
                    <label>Cor do Filamento</label>
                    <select id="corFilamento" style="margin-bottom: 10px;">
                        <option value="padrao">Padr√£o (Branco, Preto, Cinza)</option>
                        <option value="cores-basicas">Cores B√°sicas (Azul, Vermelho, Verde)</option>
                        <option value="cores-especiais">Cores Especiais (Metalizado, Transparente)</option>
                        <option value="cores-premium">Cores Premium (Glow, Madeira, Flex√≠vel)</option>
                    </select>
                    
                    <div class="color-palette">
                        <div class="color-option selected" style="background-color: #FFFFFF;" data-color="branco" title="Branco"></div>
                        <div class="color-option" style="background-color: #000000;" data-color="preto" title="Preto"></div>
                        <div class="color-option" style="background-color: #808080;" data-color="cinza" title="Cinza"></div>
                        <div class="color-option" style="background-color: #FF0000;" data-color="vermelho" title="Vermelho"></div>
                        <div class="color-option" style="background-color: #0000FF;" data-color="azul" title="Azul"></div>
                        <div class="color-option" style="background-color: #00FF00;" data-color="verde" title="Verde"></div>
                        <div class="color-option" style="background-color: #FFFF00;" data-color="amarelo" title="Amarelo"></div>
                        <div class="color-option" style="background-color: #FFA500;" data-color="laranja" title="Laranja"></div>
                        <div class="color-option" style="background-color: #800080;" data-color="roxo" title="Roxo"></div>
                        <div class="color-option" style="background-color: #964B00;" data-color="marrom" title="Marrom"></div>
                    </div>
                </div>
            </div>
            
            <div class="input-section">
                <div class="input-group">
                    <label for="precoFilamento">Pre√ßo do Filamento (por kg)</label>
                    <input type="number" id="precoFilamento" placeholder="Pre√ßo por kg" min="0" step="0.01" value="94.90">
                    <div class="price-display">
                        Pre√ßo atual: R$ <span id="precoAtual">94.90</span> por kg
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="lucro">Margem de Lucro: <span id="lucroValue">100</span>%</label>
                    <div class="slider-container">
                        <input type="range" id="lucro" class="slider" min="0" max="300" value="100">
                    </div>
                    <div class="slider-value" id="lucroValueDisplay">100%</div>
                </div>
                
                <div class="input-group">
                    <label>Bandeira Tarif√°ria (CEMIG)</label>
                    <div class="energy-flags">
                        <div class="energy-flag flag-green selected" data-flag="verde">
                            Verde
                        </div>
                        <div class="energy-flag flag-yellow" data-flag="amarela">
                            Amarela
                        </div>
                        <div class="energy-flag flag-red1" data-flag="vermelha1">
                            Vermelha 1
                        </div>
                        <div class="energy-flag flag-red2" data-flag="vermelha2">
                            Vermelha 2
                        </div>
                    </div>
                    <div class="price-display" style="margin-top: 10px;">
                        Acr√©scimo: R$ <span id="acrescimoBandeira">0.00</span> por kWh
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="complexidade">Complexidade da Pe√ßa</label>
                    <select id="complexidade">
                        <option value="1.0">Baixa (Impress√£o simples)</option>
                        <option value="1.2" selected>M√©dia (Suportes moderados)</option>
                        <option value="1.5">Alta (Muitos suportes, detalhes finos)</option>
                        <option value="2.0">Muito Alta (Pe√ßas complexas, alta chance de falha)</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="buttons">
            <button class="btn-primary" onclick="calcularCusto()">
                <i class="fas fa-calculator"></i> Calcular Custo
            </button>
            <button class="btn-success" onclick="gerarRecibo()" id="btnPDF" disabled>
                <i class="fas fa-file-pdf"></i> Gerar Recibo PDF
            </button>
            <button class="btn-secondary" onclick="limparCampos()">
                <i class="fas fa-redo"></i> Limpar Campos
            </button>
        </div>

        <div class="legal-notice">
            <h3><i class="fas fa-info-circle"></i> Informa√ß√µes Legais Importantes</h3>
            <div class="notice-content">
                <p><strong>Este documento √© um RECIBO SIMPLES, n√£o uma nota fiscal.</strong></p>
                <p>Como pessoa f√≠sica realizando vendas eventuais, voc√™ pode utilizar recibo simples para comprovar a transa√ß√£o.</p>
                <p><strong>Recomenda√ß√µes:</strong></p>
                <ul>
                    <li>Mantenha c√≥pia de todos os recibos emitidos</li>
                    <li>Registre todas as vendas em um controle simples</li>
                    <li>Para clientes PJ, verifique a necessidade de emiss√£o de nota fiscal</li>
                </ul>
                <p><em>Em caso de d√∫vidas sobre obriga√ß√µes fiscais, consulte um contador.</em></p>
            </div>
        </div>
        
        <div class="footer">
            <p>Prisma Studio &copy; 2023 - Calculadora de Impress√£o 3D</p>
        </div>
    </div>

    <div id="resultadoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModal()">&times;</span>
            <h2 class="result-title">Resultado do C√°lculo</h2>
            <div id="resultado"></div>
            <div class="buttons" style="margin-top: 20px;">
                <button class="btn-success" onclick="gerarRecibo()">
                    <i class="fas fa-file-pdf"></i> Gerar Recibo PDF
                </button>
                <button class="btn-primary" onclick="fecharModal()">
                    <i class="fas fa-check"></i> Fechar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dados das bandeiras tarif√°rias (valores por kWh)
        const bandeiras = {
            "verde": 0.00,
            "amarela": 0.01885,
            "vermelha1": 0.04463,
            "vermelha2": 0.07877
        };
        
        // Pre√ßos base por tipo de filamento
        const precosFilamento = {
            "padrao": 94.90,
            "cores-basicas": 99.90,
            "cores-especiais": 119.90,
            "cores-premium": 149.90
        };
        
        // Vari√°veis globais para armazenar os resultados
        let precoFinal = 0;
        let dadosCalculo = {};
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual como padr√£o
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataPedido').value = hoje;
            
            // Configurar bandeiras tarif√°rias
            const energyFlags = document.querySelectorAll('.energy-flag');
            energyFlags.forEach(flag => {
                flag.addEventListener('click', function() {
                    energyFlags.forEach(f => f.classList.remove('selected'));
                    this.classList.add('selected');
                    atualizarAcrescimoBandeira();
                });
            });
            
            // Configurar paleta de cores
            const colorOptions = document.querySelectorAll('.color-option');
            colorOptions.forEach(color => {
                color.addEventListener('click', function() {
                    colorOptions.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // Atualizar pre√ßo do filamento quando a categoria muda
            document.getElementById('corFilamento').addEventListener('change', function() {
                const precoFilamento = document.getElementById('precoFilamento');
                const precoAtual = document.getElementById('precoAtual');
                
                precoFilamento.value = precosFilamento[this.value];
                precoAtual.textContent = precoFilamento.value;
            });
            
            // Atualizar o valor exibido do slider de lucro
            document.getElementById('lucro').addEventListener('input', function() {
                document.getElementById('lucroValue').textContent = this.value;
                document.getElementById('lucroValueDisplay').textContent = this.value + '%';
            });
            
            // Atualizar o pre√ßo atual quando o campo √© alterado
            document.getElementById('precoFilamento').addEventListener('input', function() {
                document.getElementById('precoAtual').textContent = this.value;
            });
            
            // Inicializar o acr√©scimo da bandeira
            atualizarAcrescimoBandeira();
        });
        
        function atualizarAcrescimoBandeira() {
            const bandeiraSelecionada = document.querySelector('.energy-flag.selected').getAttribute('data-flag');
            const acrescimo = bandeiras[bandeiraSelecionada];
            document.getElementById('acrescimoBandeira').textContent = acrescimo.toFixed(5);
        }
        
        function calcularCusto() {
            // Obter valores dos inputs
            let tempoHoras = parseFloat(document.getElementById('tempoHoras').value) || 0;
            let tempoMinutos = parseFloat(document.getElementById('tempoMinutos').value) || 0;
            let filamento = parseFloat(document.getElementById('filamento').value) || 0;
            let margemLucro = parseFloat(document.getElementById('lucro').value) || 100;
            let precoFilamentoKg = parseFloat(document.getElementById('precoFilamento').value) || 94.90;
            let complexidade = parseFloat(document.getElementById('complexidade').value) || 1.2;
            
            // Obter bandeira tarif√°ria selecionada
            const bandeiraSelecionada = document.querySelector('.energy-flag.selected').getAttribute('data-flag');
            const acrescimoBandeira = bandeiras[bandeiraSelecionada];
            
            // Obter cor selecionada
            const corSelecionada = document.querySelector('.color-option.selected').getAttribute('data-color');
            
            // Converter tempo total para horas
            let tempoTotal = tempoHoras + (tempoMinutos / 60);
            
            // Valida√ß√µes
            if (tempoTotal <= 0 && filamento <= 0) {
                alert("Por favor, informe pelo menos o tempo de impress√£o ou a quantidade de filamento.");
                return;
            }
            
            // Par√¢metros de c√°lculo
            let precoKWhBase = 0.70; // Valor base do kWh (CEMIG)
            let precoKWh = precoKWhBase + acrescimoBandeira;
            let potencia = 0.1; // Impressora consome 100W (0.1 kW)
            
            // C√°lculos
            let custoEnergia = precoKWh * potencia * tempoTotal;
            let custoFilamento = (precoFilamentoKg / 1000) * filamento;
            let custoOperacional = (custoEnergia + custoFilamento) * 0.1; // 10% para manuten√ß√£o e outros custos
            let custoTotal = custoEnergia + custoFilamento + custoOperacional;
            
            // Aplicar fator de complexidade
            custoTotal *= complexidade;
            
            // Aplicar margem de lucro
            precoFinal = custoTotal * (1 + margemLucro / 100);
            
            // Salvar dados para o PDF
            dadosCalculo = {
                tempoHoras,
                tempoMinutos,
                filamento,
                corSelecionada,
                bandeiraSelecionada,
                complexidade,
                custoEnergia,
                custoFilamento,
                custoOperacional,
                custoTotal,
                precoFinal,
                margemLucro
            };
            
            // Habilitar bot√£o de PDF
            document.getElementById('btnPDF').disabled = false;
            
            // Formatar para exibi√ß√£o
            document.getElementById('resultado').innerHTML = `
                <div class="result-details">
                    <div class="result-item">
                        <span>Tempo de Impress√£o:</span>
                        <span>${tempoHoras}h ${tempoMinutos}min</span>
                    </div>
                    <div class="result-item">
                        <span>Filamento Utilizado:</span>
                        <span>${filamento.toFixed(2)}g</span>
                    </div>
                    <div class="result-item">
                        <span>Cor do Filamento:</span>
                        <span>${corSelecionada.charAt(0).toUpperCase() + corSelecionada.slice(1)}</span>
                    </div>
                    <div class="result-item">
                        <span>Bandeira Tarif√°ria:</span>
                        <span>${document.querySelector('.energy-flag.selected').textContent}</span>
                    </div>
                    <div class="result-item">
                        <span>Complexidade:</span>
                        <span>${document.getElementById('complexidade').options[document.getElementById('complexidade').selectedIndex].text}</span>
                    </div>
                    <div class="result-item">
                        <span>Custo de Energia:</span>
                        <span>R$ ${custoEnergia.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Custo do Filamento:</span>
                        <span>R$ ${custoFilamento.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Custo Operacional:</span>
                        <span>R$ ${custoOperacional.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Custo Total (sem lucro):</span>
                        <span>R$ ${custoTotal.toFixed(2)}</span>
                    </div>
                </div>
                <div class="result-total">
                    <span>Pre√ßo Final (com ${margemLucro}% de lucro):</span>
                    <span>R$ ${precoFinal.toFixed(2)}</span>
                </div>
            `;
            
            document.getElementById('resultadoModal').style.display = 'flex';
        }

        function fecharModal() {
            document.getElementById('resultadoModal').style.display = 'none';
        }
        
        function limparCampos() {
            document.getElementById('tempoHoras').value = '0';
            document.getElementById('tempoMinutos').value = '0';
            document.getElementById('filamento').value = '';
            document.getElementById('lucro').value = '100';
            document.getElementById('lucroValue').textContent = '100';
            document.getElementById('lucroValueDisplay').textContent = '100%';
            document.getElementById('precoFilamento').value = '94.90';
            document.getElementById('precoAtual').textContent = '94.90';
            document.getElementById('corFilamento').value = 'padrao';
            document.getElementById('complexidade').value = '1.2';
            document.getElementById('nomeCliente').value = '';
            document.getElementById('produto').value = '';
            document.getElementById('observacoes').value = '';
            
            // Resetar bandeira para verde
            document.querySelectorAll('.energy-flag').forEach(flag => flag.classList.remove('selected'));
            document.querySelector('.flag-green').classList.add('selected');
            atualizarAcrescimoBandeira();
            
            // Resetar cor para branco
            document.querySelectorAll('.color-option').forEach(color => color.classList.remove('selected'));
            document.querySelector('.color-option[data-color="branco"]').classList.add('selected');
            
            // Desabilitar bot√£o PDF
            document.getElementById('btnPDF').disabled = true;
        }
        
        function gerarRecibo() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Obter dados do cliente
            const nomeCliente = document.getElementById('nomeCliente').value || "Cliente n√£o informado";
            const produto = document.getElementById('produto').value || "Produto n√£o informado";
            const dataPedido = document.getElementById('dataPedido').value || new Date().toISOString().split('T')[0];
            const observacoes = document.getElementById('observacoes').value || "Nenhuma observa√ß√£o adicional";
            
            // Formatar data
            const dataFormatada = new Date(dataPedido).toLocaleDateString('pt-BR');
            
            // Cores para o PDF
            const corPrimaria = [106, 13, 173];
            const corSecundaria = [0, 191, 255];
            
            // Cabe√ßalho
            doc.setFillColor(...corPrimaria);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont('helvetica', 'bold');
            doc.text('PRISMA STUDIO', 105, 17, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text('Impress√£o 3D Profissional - Recibo de Venda', 105, 24, { align: 'center' });
            
            // T√≠tulo do recibo
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('RECIBO DE VENDA', 105, 45, { align: 'center' });
            
            // Informa√ß√µes do cliente
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('Dados do Cliente:', 20, 60);
            
            doc.setFont('helvetica', 'normal');
            doc.text(`Nome: ${nomeCliente}`, 20, 68);
            doc.text(`Produto: ${produto}`, 20, 76);
            doc.text(`Data: ${dataFormatada}`, 20, 84);
            
            // Detalhes da impress√£o
            doc.setFont('helvetica', 'bold');
            doc.text('Detalhes do Servi√ßo:', 20, 100);
            
            doc.setFont('helvetica', 'normal');
            doc.text(`‚Ä¢ Impress√£o 3D personalizada`, 20, 108);
            doc.text(`‚Ä¢ Tempo de impress√£o: ${dadosCalculo.tempoHoras}h ${dadosCalculo.tempoMinutos}min`, 20, 116);
            doc.text(`‚Ä¢ Filamento: ${dadosCalculo.filamento.toFixed(2)}g - Cor: ${dadosCalculo.corSelecionada.charAt(0).toUpperCase() + dadosCalculo.corSelecionada.slice(1)}`, 20, 124);
            doc.text(`‚Ä¢ Complexidade: ${document.getElementById('complexidade').options[document.getElementById('complexidade').selectedIndex].text}`, 20, 132);
            
            // Observa√ß√µes
            let observacoesLines = [];
            if (observacoes && observacoes !== "Nenhuma observa√ß√£o adicional") {
                doc.setFont('helvetica', 'bold');
                doc.text('Observa√ß√µes:', 20, 148);
                
                observacoesLines = doc.splitTextToSize(observacoes, 170);
                doc.setFont('helvetica', 'normal');
                doc.text(observacoesLines, 20, 156);
            }
            
            // Pre√ßo final
            const yPos = (observacoes && observacoes !== "Nenhuma observa√ß√£o adicional") ? 156 + (observacoesLines.length * 6) + 15 : 148;
            
            doc.setFillColor(...corSecundaria);
            doc.rect(15, yPos, 180, 25, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('VALOR TOTAL', 105, yPos + 10, { align: 'center' });
            
            doc.setFontSize(20);
            doc.text(`R$ ${precoFinal.toFixed(2)}`, 105, yPos + 20, { align: 'center' });
            
            // Assinatura
            const assinaturaY = yPos + 50;
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.text('_________________________________________', 105, assinaturaY, { align: 'center' });
            doc.text('Assinatura do Prestador de Servi√ßo', 105, assinaturaY + 8, { align: 'center' });
            
            // Rodap√© com informa√ß√µes legais
            const rodapeY = 270;
            doc.setTextColor(100, 100, 100);
            doc.setFontSize(8);
            doc.text('Prisma Studio - (31) 9 8339-9262', 105, rodapeY, { align: 'center' });
            doc.text('Pessoa F√≠sica - Venda Ocasional - Recibo Simples', 105, rodapeY + 5, { align: 'center' });
            doc.text('Documento v√°lido para comprova√ß√£o de transa√ß√£o entre particulares', 105, rodapeY + 10, { align: 'center' });
            
            // Salvar o PDF
            doc.save(`Recibo_${produto.replace(/\s+/g, '_')}_${dataFormatada.replace(/\//g, '-')}.pdf`);
        }
    </script>
</body>
</html>
